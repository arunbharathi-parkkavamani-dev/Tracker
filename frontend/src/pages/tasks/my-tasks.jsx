import { useState, useEffect } from 'react';\nimport axiosInstance from '../../api/axiosInstance';\nimport { useAuth } from '../../context/authProvider';\nimport KanbanBoard from '../../components/Common/KambanBoard';\nimport CreateTaskModal from './CreateTaskModal';\nimport TaskModal from './TaskModal';\nimport { User } from 'lucide-react';\n\nconst MyTasks = () => {\n  const { user } = useAuth();\n  const [tasks, setTasks] = useState([]);\n  const [selectedTask, setSelectedTask] = useState(null);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [kanbanView, setKanbanView] = useState('status');\n  const [employees, setEmployees] = useState([]);\n  const [taskTypes, setTaskTypes] = useState([]);\n\n  useEffect(() => {\n    fetchMyTasks();\n    fetchEmployees();\n    fetchTaskTypes();\n  }, []);\n\n  const fetchMyTasks = async () => {\n    try {\n      setLoading(true);\n      const response = await axiosInstance.get(`/populate/read/tasks?filter={\"$or\":[{\"createdBy\":\"${user.id}\"},{\"assignedTo\":\"${user.id}\"}]}&fields=clientId,projectTypeId,taskTypeId,createdBy,assignedTo`);\n      const tasksData = response.data.data || [];\n      setTasks(tasksData);\n    } catch (error) {\n      console.error('Error fetching my tasks:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchEmployees = async () => {\n    try {\n      const response = await axiosInstance.get('/populate/read/employees');\n      setEmployees(response.data.data || []);\n    } catch (error) {\n      console.error('Error fetching employees:', error);\n    }\n  };\n\n  const fetchTaskTypes = async () => {\n    try {\n      const response = await axiosInstance.get('/populate/read/tasktypes');\n      setTaskTypes(response.data.data || []);\n    } catch (error) {\n      console.error('Error fetching task types:', error);\n    }\n  };\n\n  const handleTaskClick = async (task) => {\n    try {\n      const response = await axiosInstance.get(`/populate/read/tasks/${task._id}?fields=clientId,projectTypeId,taskTypeId,createdBy,assignedTo`);\n      setSelectedTask(response.data.data);\n    } catch (error) {\n      console.error('Error fetching task details:', error);\n    }\n  };\n\n  const handleTaskUpdate = () => {\n    fetchMyTasks();\n    setSelectedTask(null);\n  };\n\n  const statusColumns = [\n    { id: 'Backlogs', title: 'Backlogs', color: 'bg-gray-500' },\n    { id: 'To Do', title: 'To Do', color: 'bg-orange-500' },\n    { id: 'In Progress', title: 'In Progress', color: 'bg-blue-500' },\n    { id: 'In Review', title: 'In Review', color: 'bg-purple-500' },\n    { id: 'Approved', title: 'Approved', color: 'bg-green-500' },\n    { id: 'Completed', title: 'Completed', color: 'bg-green-700' }\n  ];\n\n  const priorityColumns = [\n    { id: 'Low', title: 'Low Priority', color: 'bg-green-500' },\n    { id: 'Medium', title: 'Medium Priority', color: 'bg-yellow-500' },\n    { id: 'High', title: 'High Priority', color: 'bg-red-500' },\n    { id: 'Weekly Priority', title: 'Weekly Priority', color: 'bg-purple-500' }\n  ];\n\n  const myCreatedTasks = tasks.filter(t => t.createdBy?._id === user.id).length;\n  const myAssignedTasks = tasks.filter(t => t.assignedTo?.some(a => a._id === user.id)).length;\n  const inProgressTasks = tasks.filter(t => t.status === 'In Progress').length;\n\n  if (loading) return (\n    <div className=\"flex items-center justify-center h-64\">\n      <div className=\"text-lg\">Loading tasks...</div>\n    </div>\n  );\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-6 border-b\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\">\n              <User className=\"h-6 w-6\" />\n              My Tasks\n            </h1>\n            <p className=\"text-gray-600 text-sm\">Tasks created by you or assigned to you</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <button \n              onClick={() => setKanbanView('status')}\n              className={`px-3 py-1 text-sm rounded ${\n                kanbanView === 'status' \n                  ? 'bg-blue-100 text-blue-700' \n                  : 'bg-gray-100 text-gray-600'\n              }`}\n            >\n              By Status\n            </button>\n            <button \n              onClick={() => setKanbanView('priority')}\n              className={`px-3 py-1 text-sm rounded ${\n                kanbanView === 'priority' \n                  ? 'bg-blue-100 text-blue-700' \n                  : 'bg-gray-100 text-gray-600'\n              }`}\n            >\n              By Priority\n            </button>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid gap-4 md:grid-cols-3 mt-6\">\n          <div className=\"bg-blue-50/50 border border-blue-100 rounded-lg p-4\">\n            <div className=\"pb-2\">\n              <h3 className=\"text-sm font-medium text-blue-600\">Created by Me</h3>\n            </div>\n            <div className=\"text-2xl font-bold\">{myCreatedTasks}</div>\n          </div>\n          \n          <div className=\"bg-green-50/50 border border-green-100 rounded-lg p-4\">\n            <div className=\"pb-2\">\n              <h3 className=\"text-sm font-medium text-green-600\">Assigned to Me</h3>\n            </div>\n            <div className=\"text-2xl font-bold\">{myAssignedTasks}</div>\n          </div>\n          \n          <div className=\"bg-orange-50/50 border border-orange-100 rounded-lg p-4\">\n            <div className=\"pb-2\">\n              <h3 className=\"text-sm font-medium text-orange-600\">In Progress</h3>\n            </div>\n            <div className=\"text-2xl font-bold\">{inProgressTasks}</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Kanban Board */}\n      <div className=\"flex-1 overflow-hidden\">\n        <KanbanBoard\n          data={tasks}\n          groupBy={kanbanView === 'status' ? 'status' : 'priorityLevel'}\n          columns={kanbanView === 'status' ? statusColumns : priorityColumns}\n          currentUserId={user?.id}\n          onCardClick={handleTaskClick}\n          onCardMove={(task, fromStatus, toStatus) => {\n            console.log('Move task:', task.title, 'from', fromStatus, 'to', toStatus);\n          }}\n          title=\"My Tasks\"\n          subtitle=\"Tasks created by you or assigned to you\"\n          employees={employees}\n          taskTypes={taskTypes}\n          kanbanView={kanbanView}\n          onNewTask={() => setShowCreateModal(true)}\n        />\n      </div>\n\n      {/* Modals */}\n      {selectedTask && (\n        <TaskModal\n          task={selectedTask}\n          onClose={() => setSelectedTask(null)}\n          onUpdate={handleTaskUpdate}\n        />\n      )}\n\n      {showCreateModal && (\n        <CreateTaskModal\n          onClose={() => setShowCreateModal(false)}\n          onCreated={() => {\n            fetchMyTasks();\n            setShowCreateModal(false);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default MyTasks;